{"version":3,"file":"index.js","sources":["../../src/py-to-ts/transpiler.ts","../../src/py-to-ts/SourceMap.ts","../../src/py-to-ts/utils.ts","../../src/py-to-ts/toStringLiteralJS.ts","../../src/py-to-ts/asserts.ts"],"sourcesContent":["import { assert } from './asserts';\nimport { Visitor } from 'typhon-lang';\nimport { AnnAssign } from 'typhon-lang';\nimport { Assign } from 'typhon-lang';\nimport { Attribute } from 'typhon-lang';\nimport { BinOp, Add, Sub, Mult, Div, BitOr, BitXor, BitAnd, LShift, RShift, FloorDiv, Mod } from 'typhon-lang';\nimport { Call } from 'typhon-lang';\nimport { ClassDef } from 'typhon-lang';\nimport { Compare, Eq, NotEq, Gt, GtE, Lt, LtE, In, NotIn, Is, IsNot } from 'typhon-lang';\nimport { Dict } from 'typhon-lang';\nimport { ExpressionStatement } from 'typhon-lang';\nimport { ForStatement } from 'typhon-lang';\nimport { FunctionDef } from 'typhon-lang';\nimport { Name } from 'typhon-lang';\nimport { IfStatement } from 'typhon-lang';\nimport { ImportFrom } from 'typhon-lang';\nimport { List } from 'typhon-lang';\nimport { Module } from 'typhon-lang';\nimport { Num } from 'typhon-lang';\nimport { Print } from 'typhon-lang';\nimport { ReturnStatement } from 'typhon-lang';\nimport { Str } from 'typhon-lang';\nimport { parse, SourceKind } from 'typhon-lang';\nimport { astFromParse } from 'typhon-lang';\nimport { semanticsOfModule } from 'typhon-lang';\nimport { SymbolTable } from 'typhon-lang';\nimport { SymbolTableScope } from 'typhon-lang';\nimport { toStringLiteralJS } from './toStringLiteralJS';\nimport { SymbolFlags } from 'typhon-lang';\nimport { DEF_LOCAL } from 'typhon-lang';\nimport { isClassNameByConvention, isMethod } from './utils';\nimport { CodeWriter, TextAndMappings } from 'code-writer';\nimport { MappingTree } from 'code-writer';\nimport { Position, positionComparator } from 'code-writer';\nimport { RBTree } from 'generic-rbtree';\nimport { SourceMap } from './SourceMap';\n/**\n * Provides enhanced scope information beyond the SymbolTableScope.\n */\nclass PrinterUnit {\n    readonly ste: SymbolTableScope;\n    readonly name: string;\n    /**\n     * Some sort of private name?\n     */\n    private_: string;\n    beginLine: number;\n    beginColumn: number;\n    lineno: number;\n    /**\n     * Has the line number been set?\n     */\n    linenoSet: boolean;\n    localnames: string[];\n    blocknum: number;\n    /**\n     * TODO: What are these blocks?\n     */\n    blocks: any[];\n    curblock: number;\n    /**\n     * Used to determine whether a local variable has been declared.\n     */\n    declared: { [name: string]: boolean } = {};\n    scopename: string;\n    prefixCode: string;\n    varDeclsCode: string;\n    switchCode: string;\n    suffixCode: string;\n    breakCode: string;\n    breakBlocks: number[];\n    continueBlocks: number[];\n    exceptBlocks: number[];\n    finallyBlocks: number[];\n    argnames: string[];\n    /**\n     * Stuff that changes on entry/exit of code blocks. must be saved and restored\n     * when returning to a block.\n     * Corresponds to the body of a module, class, or function.\n     */\n    constructor(name: string, ste: SymbolTableScope) {\n        assert(typeof name === 'string');\n        assert(typeof ste === 'object');\n        this.name = name;\n        this.ste = ste;\n\n        this.private_ = null;\n        this.beginLine = 0;\n        this.lineno = 0;\n        this.linenoSet = false;\n        this.localnames = [];\n\n        this.blocknum = 0;\n        this.blocks = [];\n        this.curblock = 0;\n\n        this.scopename = null;\n\n        this.prefixCode = '';\n        this.varDeclsCode = '';\n        this.switchCode = '';\n        this.suffixCode = '';\n\n        // stack of where to go on a break\n        this.breakBlocks = [];\n        // stack of where to go on a continue\n        this.continueBlocks = [];\n        this.exceptBlocks = [];\n        this.finallyBlocks = [];\n    }\n    activateScope(): void {\n        // Do nothing yet.\n    }\n    deactivateScope(): void {\n        // Do nothing yet.\n    }\n}\n\nclass Printer implements Visitor {\n    /**\n     * The output of all units.\n     */\n    public result: string[];\n    /**\n     * Used to instrument the code with the name of the file.\n     */\n    // private fileName: string;\n    /**\n     * When a scope is entered, used to obtain the corresponding SymbolTableScope.\n     * A CompilerUnit is created for each scope.\n     */\n    private st: SymbolTable;\n    /**\n     * Not being used (but being carried through).\n     */\n    // private flags: number;\n    /**\n     * Not being used. Default is false.\n     */\n    // private interactive: boolean;\n    /**\n     * Incremented(Decremented) when entering(leaving) a scope.\n     * Default is 0.\n     * Not being used.\n     * It seems a bit redundant because it can be obtained from the stack.length property.\n     */\n    // private nestlevel: number;\n    /**\n     * Provides custom information about the current scope.\n     * Default is null.\n     */\n    private u: PrinterUnit;\n    /**\n     * Pushed(Popped) when entering(leaving) a scope.\n     * Default is [].\n     * Used to provide the compiler unit as scopes are popped.\n     */\n    private stack: PrinterUnit[];\n    /**\n     * Pushed whenever we enter a cope, but never popped.\n     */\n    private allUnits: PrinterUnit[];\n    /**\n     * Used to provide comments referencing the original source in the transpiled code.\n     */\n    // private source: string[] | boolean;\n\n    /**\n     * The output buffer.\n     * This will be joined into a single string.\n     */\n    private writer: CodeWriter;\n    /**\n     * Used to provide a unique number for generated symbol names.\n     */\n    private gensymCount = 0;\n    /**\n     *\n     * @param st The symbol table obtained from semantic analysis.\n     * @param flags Not being used yet. May become options.\n     * @param sourceText The original source code, provided for annotating the generated code and source mapping.\n     */\n    constructor(st: SymbolTable, flags: number, sourceText: string, private beginLine: number, private beginColumn: number, trace: boolean) {\n        // this.fileName = fileName;\n        this.st = st;\n        // this.flags = flags;\n        // this.interactive = false;\n        // this.nestlevel = 0;\n        this.u = null;\n        this.stack = [];\n        this.result = [];\n        // this.gensymcount = 0;\n        this.allUnits = [];\n        // this.source = sourceText ? sourceText.split(\"\\n\") : false;\n        this.writer = new CodeWriter(beginLine, beginColumn, {}, trace);\n    }\n\n    /**\n     * This is the entry point for this visitor.\n     */\n    transpileModule(module: Module): TextAndMappings {\n\n        // Traversing the AST sends commands to the writer.\n        this.enterScope(\"<module>\", module, this.beginLine, this.beginColumn);\n        this.module(module);\n        this.exitScope();\n\n        // Now return the captured events as a transpiled module.\n        return this.writer.snapshot();\n    }\n\n    /**\n     * Looks up the SymbolTableScope.\n     * Pushes a new PrinterUnit onto the stack.\n     * Returns a string identifying the scope.\n     * @param name The name that will be assigned to the PrinterUnit.\n     * @param key A scope object in the AST from sematic analysis. Provides the mapping to the SymbolTableScope.\n     */\n    enterScope(name: string, key: { scopeId: number }, beginLine: number, beginColumn: number): string {\n        const u = new PrinterUnit(name, this.st.getStsForAst(key));\n        u.beginLine = beginLine;\n        u.beginColumn = beginColumn;\n\n        if (this.u && this.u.private_) {\n            u.private_ = this.u.private_;\n        }\n\n        this.stack.push(this.u);\n        this.allUnits.push(u);\n        const scopeName = this.gensym('scope');\n        u.scopename = scopeName;\n\n        this.u = u;\n        this.u.activateScope();\n\n        // this.nestlevel++;\n\n        return scopeName;\n    }\n\n    exitScope() {\n        if (this.u) {\n            this.u.deactivateScope();\n        }\n        // this.nestlevel--;\n        if (this.stack.length - 1 >= 0) {\n            this.u = this.stack.pop();\n        }\n        else {\n            this.u = null;\n        }\n        if (this.u) {\n            this.u.activateScope();\n        }\n    }\n\n    forStatement(fs: ForStatement) {\n        const body = fs.body;\n        const range = fs.iter;\n        const target = fs.target;\n        this.writer.write(\"for\", null);\n        this.writer.openParen();\n\n        if (range instanceof Call) {\n            this.writer.beginStatement();\n\n            if (target instanceof Name) {\n                const flags: SymbolFlags = this.u.ste.symFlags[target.id.value];\n                if (flags && DEF_LOCAL) {\n                    if (this.u.declared[target.id.value]) {\n                        // The variable has already been declared.\n                    }\n                    else {\n                        // We use let for now because we would need to look ahead for more assignments.\n                        // The smenatic analysis could count the number of assignments in the current scope?\n                        this.writer.write(\"let \", null);\n                        this.u.declared[target.id.value] = true;\n                    }\n                }\n            }\n            target.accept(this);\n\n            this.writer.write(\"=\", null);\n\n            const secondArg = range.args[1];\n            const thirdArg = range.args[2];\n            if (range.args[3]) {\n                throw new Error(\"Too many arguments\");\n            }\n            // range() accepts 1 or 2 parameters, if 1 then first param is always 0\n            if (secondArg) {\n                const firstArg = range.args[0];\n                firstArg.accept(this);\n                this.writer.endStatement();\n            }\n            else {\n                this.writer.write(\"0\", null);\n                this.writer.endStatement();\n            }\n\n            // writing second part of for statement\n            this.writer.beginStatement();\n            target.accept(this);\n            this.writer.write(\"<\", null);\n            secondArg.accept(this);\n            this.writer.endStatement();\n\n            // writing third part of for statement\n            if (thirdArg) {\n                target.accept(this);\n                this.writer.write(\"=\", null);\n                target.accept(this);\n                this.writer.write(\"+\", null);\n                thirdArg.accept(this);\n            }\n            else {\n                target.accept(this);\n                this.writer.write(\"++\", null);\n            }\n\n        }\n        else if (range instanceof Name) {\n            // \"for (\" written so far\n            const greedyIterator = range.id.value; // The list to iterate over\n            this.writer.write(\"let \", null);\n\n            if (target instanceof Name) {\n                const flags: SymbolFlags = this.u.ste.symFlags[target.id.value];\n                if (flags && DEF_LOCAL) {\n                    if (this.u.declared[target.id.value]) {\n                        // The variable has already been declared.\n                    }\n                    else {\n                        // We use let for now because we would need to look ahead for more assignments.\n                        // The smenatic analysis could count the number of assignments in the current scope?\n                        this.writer.write(\"let \", null);\n                        this.u.declared[target.id.value] = true;\n                    }\n                }\n            }\n            target.accept(this);\n\n            this.writer.write(\" of\", null);\n            this.writer.write(` ${greedyIterator}`, null);\n        }\n        else {\n            console.log(range);\n            throw new Error(`Invalid range... range is instance of ${range.constructor.name}, not 'Call' or 'Name'`);\n        }\n        this.writer.closeParen();\n        this.writer.beginBlock();\n        for (const stmt of body) {\n            this.writer.beginStatement();\n            stmt.accept(this);\n            this.writer.endStatement();\n        }\n        this.writer.endBlock();\n    }\n\n    /**\n     * Generates a unique symbol name for the provided namespace.\n     */\n    gensym(namespace?: 'scope'): string {\n        let symbolName = namespace || '';\n        symbolName = '$' + symbolName;\n        symbolName += this.gensymCount++;\n        return symbolName;\n    }\n\n    // Everything below here is an implementation of the Visitor\n    annAssign(annassign: AnnAssign): void {\n        this.writer.beginStatement();\n        // TODO: Declaration.\n        // TODO: How to deal with multiple target?\n        /**\n         * Decides whether to write let or not\n         */\n        const target = annassign.target;\n        if (target instanceof Name) {\n            const flags: SymbolFlags = this.u.ste.symFlags[target.id.value];\n            if (flags && DEF_LOCAL) {\n                if (this.u.declared[target.id.value]) {\n                    // The variable has already been declared.\n                }\n                else {\n                    // We use let for now because we would need to look ahead for more assignments.\n                    // The smenatic analysis could count the number of assignments in the current scope?\n                    this.writer.write(\"let \", null);\n                    this.u.declared[target.id.value] = true;\n                }\n            }\n        }\n        target.accept(this);\n        if (annassign.value) {\n            this.writer.write(\":\", null);\n            annassign.value.accept(this);\n        }\n        this.writer.endStatement();\n    }\n    assign(assign: Assign): void {\n        this.writer.beginStatement();\n        // TODO: Declaration.\n        // TODO: How to deal with multiple target?\n        /**\n         * Decides whether to write let or not\n         */\n        for (const target of assign.targets) {\n            if (target instanceof Name) {\n                const flags: SymbolFlags = this.u.ste.symFlags[target.id.value];\n                if (flags && DEF_LOCAL) {\n                    if (this.u.declared[target.id.value]) {\n                        // The variable has already been declared.\n                    }\n                    else {\n                        // We use let for now because we would need to look ahead for more assignments.\n                        // The smenatic analysis could count the number of assignments in the current scope?\n                        this.writer.write(\"let \", null);\n                        this.u.declared[target.id.value] = true;\n                    }\n                }\n            }\n            target.accept(this);\n            if (assign.type) {\n                this.writer.write(\":\", null);\n                assign.type.accept(this);\n            }\n        }\n        this.writer.assign(\"=\", assign.eqRange);\n        assign.value.accept(this);\n        this.writer.endStatement();\n    }\n    attribute(attribute: Attribute): void {\n        attribute.value.accept(this);\n        this.writer.write(\".\", null);\n        this.writer.str(attribute.attr.value, attribute.attr.range);\n    }\n    binOp(be: BinOp): void {\n        be.lhs.accept(this);\n        const op = be.op;\n        const opRange = be.opRange;\n        switch (op) {\n            case Add: {\n                this.writer.binOp(\"+\", opRange);\n                break;\n            }\n            case Sub: {\n                this.writer.binOp(\"-\", opRange);\n                break;\n            }\n            case Mult: {\n                this.writer.binOp(\"*\", opRange);\n                break;\n            }\n            case Div: {\n                this.writer.binOp(\"/\", opRange);\n                break;\n            }\n            case BitOr: {\n                this.writer.binOp(\"|\", opRange);\n                break;\n            }\n            case BitXor: {\n                this.writer.binOp(\"^\", opRange);\n                break;\n            }\n            case BitAnd: {\n                this.writer.binOp(\"&\", opRange);\n                break;\n            }\n            case LShift: {\n                this.writer.binOp(\"<<\", opRange);\n                break;\n            }\n            case RShift: {\n                this.writer.binOp(\">>\", opRange);\n                break;\n            }\n            case Mod: {\n                this.writer.binOp(\"%\", opRange);\n                break;\n            }\n            case FloorDiv: {\n                // TODO: What is the best way to handle FloorDiv.\n                // This doesn't actually exist in TypeScript.\n                this.writer.binOp(\"//\", opRange);\n                break;\n            }\n            default: {\n                throw new Error(`Unexpected binary operator ${op}: ${typeof op}`);\n            }\n        }\n        be.rhs.accept(this);\n    }\n    callExpression(ce: Call): void {\n        if (ce.func instanceof Name) {\n            if (isClassNameByConvention(ce.func)) {\n                this.writer.write(\"new \", null);\n            }\n        }\n        else if (ce.func instanceof Attribute) {\n            if (isClassNameByConvention(ce.func)) {\n                this.writer.write(\"new \", null);\n            }\n        }\n        else {\n            throw new Error(`Call.func must be a Name ${ce.func}`);\n        }\n        ce.func.accept(this);\n        this.writer.openParen();\n        for (let i = 0; i < ce.args.length; i++) {\n            if (i > 0) {\n                this.writer.comma(null, null);\n            }\n            const arg = ce.args[i];\n            arg.accept(this);\n        }\n        for (let i = 0; i < ce.keywords.length; ++i) {\n            if (i > 0) {\n                this.writer.comma(null, null);\n            }\n            ce.keywords[i].value.accept(this);\n        }\n        if (ce.starargs) {\n            ce.starargs.accept(this);\n        }\n        if (ce.kwargs) {\n            ce.kwargs.accept(this);\n        }\n        this.writer.closeParen();\n    }\n    classDef(cd: ClassDef): void {\n        this.writer.write(\"class\", null);\n        this.writer.space();\n        this.writer.name(cd.name.value, cd.name.range);\n        // this.writer.openParen();\n        // this.writer.closeParen();\n        this.writer.beginBlock();\n        /*\n        this.writer.write(\"constructor\");\n        this.writer.openParen();\n        this.writer.closeParen();\n        this.writer.beginBlock();\n        this.writer.endBlock();\n        */\n        for (const stmt of cd.body) {\n            stmt.accept(this);\n        }\n        this.writer.endBlock();\n    }\n    compareExpression(ce: Compare) {\n        ce.left.accept(this);\n        for (const op of ce.ops) {\n            switch (op) {\n                case Eq: {\n                    this.writer.write(\"===\", null);\n                    break;\n                }\n                case NotEq: {\n                    this.writer.write(\"!==\", null);\n                    break;\n                }\n                case Lt: {\n                    this.writer.write(\"<\", null);\n                    break;\n                }\n                case LtE: {\n                    this.writer.write(\"<=\", null);\n                    break;\n                }\n                case Gt: {\n                    this.writer.write(\">\", null);\n                    break;\n                }\n                case GtE: {\n                    this.writer.write(\">=\", null);\n                    break;\n                }\n                case Is: {\n                    this.writer.write(\"===\", null);\n                    break;\n                }\n                case IsNot: {\n                    this.writer.write(\"!==\", null);\n                    break;\n                }\n                case In: {\n                    this.writer.write(\" in \", null);\n                    break;\n                }\n                case NotIn: {\n                    this.writer.write(\" not in \", null);\n                    break;\n                }\n                default: {\n                    throw new Error(`Unexpected comparison expression operator: ${op}`);\n                }\n            }\n        }\n        for (const comparator of ce.comparators) {\n            comparator.accept(this);\n        }\n    }\n    dict(dict: Dict): void {\n        const keys = dict.keys;\n        const values = dict.values;\n        const N = keys.length;\n        this.writer.beginObject();\n        for (let i = 0; i < N; i++) {\n            if (i > 0) {\n                this.writer.comma(null, null);\n            }\n            keys[i].accept(this);\n            this.writer.write(\":\", null);\n            values[i].accept(this);\n        }\n        this.writer.endObject();\n    }\n    expressionStatement(s: ExpressionStatement): void {\n        this.writer.beginStatement();\n        s.value.accept(this);\n        this.writer.endStatement();\n    }\n    functionDef(functionDef: FunctionDef): void {\n        const isClassMethod = isMethod(functionDef);\n        const sts = this.st.getStsForAst(functionDef);\n        const parentScope = this.u.ste;\n        for (const scope of parentScope.children) {\n            if (sts === scope) {\n                this.writer.write(\"export \", null);\n            }\n        }\n        if (!isClassMethod) {\n            this.writer.write(\"function \", null);\n        }\n        this.writer.name(functionDef.name.value, functionDef.name.range);\n        this.writer.openParen();\n        for (let i = 0; i < functionDef.args.args.length; i++) {\n            const arg = functionDef.args.args[i];\n            const argType = arg.type;\n            if (i === 0) {\n                if (arg.name.id.value === 'self') {\n                    // Ignore.\n                }\n                else {\n                    arg.name.accept(this);\n                    if (argType) {\n                        this.writer.write(\":\", null);\n                        argType.accept(this);\n                    }\n                }\n            }\n            else {\n                arg.name.accept(this);\n                if (argType) {\n                    this.writer.write(\":\", null);\n                    argType.accept(this);\n                }\n            }\n        }\n        this.writer.closeParen();\n        if (functionDef.returnType) {\n            this.writer.write(\":\", null);\n            functionDef.returnType.accept(this);\n        }\n\n\n        this.writer.beginBlock();\n\n        for (const stmt of functionDef.body) {\n            stmt.accept(this);\n        }\n        this.writer.endBlock();\n    }\n    ifStatement(i: IfStatement): void {\n        this.writer.write(\"if\", null);\n        this.writer.openParen();\n        i.test.accept(this);\n        this.writer.closeParen();\n        this.writer.beginBlock();\n        for (const con of i.consequent) {\n            con.accept(this);\n        }\n        this.writer.endBlock();\n    }\n    importFrom(importFrom: ImportFrom): void {\n        this.writer.beginStatement();\n        this.writer.write(\"import\", null);\n        this.writer.space();\n        this.writer.beginBlock();\n        for (let i = 0; i < importFrom.names.length; i++) {\n            if (i > 0) {\n                this.writer.comma(null, null);\n            }\n            const alias = importFrom.names[i];\n            this.writer.name(alias.name.value, alias.name.range);\n            if (alias.asname) {\n                this.writer.space();\n                this.writer.write(\"as\", null);\n                this.writer.space();\n                this.writer.write(alias.asname, null);\n            }\n        }\n        this.writer.endBlock();\n        this.writer.space();\n        this.writer.write(\"from\", null);\n        this.writer.space();\n        this.writer.str(toStringLiteralJS(importFrom.module.value), importFrom.module.range);\n        this.writer.endStatement();\n    }\n    list(list: List): void {\n        const elements = list.elts;\n        const N = elements.length;\n        this.writer.write('[', null);\n        for (let i = 0; i < N; i++) {\n            if (i > 0) {\n                this.writer.comma(null, null);\n            }\n            elements[i].accept(this);\n        }\n        this.writer.write(']', null);\n    }\n    module(m: Module): void {\n        for (const stmt of m.body) {\n            stmt.accept(this);\n        }\n    }\n    name(name: Name): void {\n        // TODO: Since 'True' and 'False' are reserved words in Python,\n        // syntactic analysis (parsing) should be sufficient to identify\n        // this name as a boolean expression - avoiding this overhead.\n        const value = name.id.value;\n        const range = name.id.range;\n        switch (value) {\n            case 'True': {\n                this.writer.name('true', range);\n                break;\n            }\n            case 'False': {\n                this.writer.name('false', range);\n                break;\n            }\n            case 'str': {\n                this.writer.name('string', range);\n                break;\n            }\n            case 'num': {\n                this.writer.name('number', range);\n                break;\n            }\n            case 'None': {\n                this.writer.name('null', range);\n                break;\n            }\n            /*\n            case 'dict': {\n                const testDict = \"(function dict(...keys: dictVal[]):Dict {const dict1 = new Dict(keys); return dict1;})\";\n                this.writer.name(`${testDict}`, range);\n                break;\n            }\n            */\n            case 'bool': {\n                this.writer.name('boolean', range);\n                break;\n            }\n            default: {\n                this.writer.name(value, range);\n            }\n        }\n    }\n    num(num: Num): void {\n        const value = num.n.value;\n        const range = num.n.range;\n        this.writer.num(value.toString(), range);\n    }\n    print(print: Print): void {\n        this.writer.name(\"console\", null);\n        this.writer.write(\".\", null);\n        this.writer.name(\"log\", null);\n        this.writer.openParen();\n        for (const value of print.values) {\n            value.accept(this);\n        }\n        this.writer.closeParen();\n    }\n    returnStatement(rs: ReturnStatement): void {\n        this.writer.beginStatement();\n        this.writer.write(\"return\", null);\n        this.writer.write(\" \", null);\n        rs.value.accept(this);\n        this.writer.endStatement();\n    }\n    str(str: Str): void {\n        const s = str.s;\n        // const begin = str.begin;\n        // const end = str.end;\n        this.writer.str(toStringLiteralJS(s.value), s.range);\n    }\n}\n\nexport function transpileModule(sourceText: string, trace = false): { code: string; sourceMap: SourceMap; } {\n    const cst = parse(sourceText, SourceKind.File);\n    if (typeof cst === 'object') {\n        const stmts = astFromParse(cst);\n        const mod = new Module(stmts);\n        const symbolTable = semanticsOfModule(mod);\n        const printer = new Printer(symbolTable, 0, sourceText, 1, 0, trace);\n        const textAndMappings = printer.transpileModule(mod);\n        const code = textAndMappings.text;\n        const sourceMap = mappingTreeToSourceMap(textAndMappings.tree, trace);\n        return { code, sourceMap };\n    }\n    else {\n        throw new Error(`Error parsing source for file.`);\n    }\n}\n\nconst NIL_VALUE = new Position(Number.MAX_SAFE_INTEGER, Number.MAX_SAFE_INTEGER);\nconst HI_KEY = new Position(Number.MAX_SAFE_INTEGER, Number.MAX_SAFE_INTEGER);\nconst LO_KEY = new Position(Number.MIN_SAFE_INTEGER, Number.MIN_SAFE_INTEGER);\n\nfunction mappingTreeToSourceMap(mappingTree: MappingTree, trace: boolean): SourceMap {\n    const sourceToTarget = new RBTree<Position, Position>(LO_KEY, HI_KEY, NIL_VALUE, positionComparator);\n    const targetToSource = new RBTree<Position, Position>(LO_KEY, HI_KEY, NIL_VALUE, positionComparator);\n    if (mappingTree) {\n        for (const mapping of mappingTree.mappings()) {\n            const source = mapping.source;\n            const target = mapping.target;\n            // Convert to immutable values for targets.\n            const tBegin = new Position(target.begin.line, target.begin.column);\n            const tEnd = new Position(target.end.line, target.end.column);\n            if (trace) {\n                console.log(`${source.begin} => ${tBegin}`);\n                console.log(`${source.end} => ${tEnd}`);\n            }\n            sourceToTarget.insert(source.begin, tBegin);\n            sourceToTarget.insert(source.end, tEnd);\n            targetToSource.insert(tBegin, source.begin);\n            targetToSource.insert(tEnd, source.end);\n        }\n    }\n    return new SourceMap(sourceToTarget, targetToSource);\n}\n","import { RBTree } from 'generic-rbtree';\nimport { Position } from 'code-writer';\n\nexport class SourceMap {\n    constructor(private sourceToTarget: RBTree<Position, Position>, private targetToSource: RBTree<Position, Position>) {\n        // Do nothing yet.\n    }\n    getTargetPosition(sourcePos: Position): Position | null {\n        const nodeL = this.sourceToTarget.glb(sourcePos);\n        const nodeU = this.sourceToTarget.lub(sourcePos);\n        if (nodeL) {\n            if (nodeU) {\n                return interpolate(sourcePos.line, sourcePos.column, nodeL.key, nodeL.value);\n            }\n            else {\n                return null;\n            }\n        }\n        else {\n            return null;\n        }\n    }\n    getSourcePosition(targetPos: Position): Position {\n        const nodeL = this.targetToSource.glb(targetPos);\n        if (nodeL) {\n            return interpolate(targetPos.line, targetPos.column, nodeL.key, nodeL.value);\n        }\n        else {\n            return null;\n        }\n    }\n}\n\nfunction interpolate(sourceLine: number, sourceColumn: number, sourceBegin: Position, targetBegin: Position): Position {\n    const lineOffset = sourceLine - sourceBegin.line;\n    const columnOffset = sourceColumn - sourceBegin.column;\n    const targetLine = targetBegin.line + lineOffset;\n    const targetColumn = targetBegin.column + columnOffset;\n    return new Position(targetLine, targetColumn);\n}\n","import { Attribute } from 'typhon-lang';\nimport { FunctionDef } from 'typhon-lang';\nimport { Name } from 'typhon-lang';\nimport { RangeAnnotated } from 'typhon-lang';\n\n/**\n * Determines whether the name or attribute should be considered to be a class.\n * This is a heuristic test based upon the JavaScript convention for class names.\n * In future we may be able to use type information.\n */\nexport function isClassNameByConvention(name: Attribute | Name): boolean {\n    const id = name.id;\n    if (id instanceof RangeAnnotated && typeof id.value === 'string') {\n        // console.lg(`name => ${JSON.stringify(name, null, 2)}`);\n        const N = id.value.length;\n        if (N > 0) {\n            const firstChar = id.value[0];\n            return firstChar.toUpperCase() === firstChar;\n        }\n        else {\n            return false;\n        }\n    }\n    else {\n        return false;\n    }\n}\n\nexport function isMethod(functionDef: FunctionDef): boolean {\n    for (let i = 0; i < functionDef.args.args.length; i++) {\n        if (i === 0) {\n            const arg = functionDef.args.args[i];\n            if (arg.name.id.value === 'self') {\n                return true;\n            }\n        }\n        else {\n            return false;\n        }\n    }\n    return false;\n}\n","/**\n * FIXME: Argument should be declared as string but not allowed by TypeScript compiler.\n * May be a bug when comparing to 0x7f below.\n */\nexport function toStringLiteralJS(value: string): string {\n    // single is preferred\n    let quote = \"'\";\n    if (value.indexOf(\"'\") !== -1 && value.indexOf('\"') === -1) {\n        quote = '\"';\n    }\n    const len = value.length;\n    let ret = quote;\n    for (let i = 0; i < len; ++i) {\n        const c = value.charAt(i);\n        if (c === quote || c === '\\\\')\n            ret += '\\\\' + c;\n        else if (c === '\\t')\n            ret += '\\\\t';\n        else if (c === '\\n')\n            ret += '\\\\n';\n        else if (c === '\\r')\n            ret += '\\\\r';\n        else if (c < ' ' || c as any >= 0x7f) {\n            let ashex = c.charCodeAt(0).toString(16);\n            if (ashex.length < 2) ashex = \"0\" + ashex;\n            ret += \"\\\\x\" + ashex;\n        }\n        else\n            ret += c;\n    }\n    ret += quote;\n    return ret;\n}\n","/**\n * We're looking for something that is truthy, not just true.\n */\nexport function assert(condition: any, message?: string): void {\n    if (!condition) {\n        throw new Error(message);\n    }\n}\n\nexport function fail(message: string): void {\n    assert(false, message);\n}\n"],"names":["Position","RBTree","positionComparator","semanticsOfModule","Module","astFromParse","parse","SourceKind","NotIn","In","IsNot","Is","GtE","Gt","LtE","Lt","NotEq","Eq","Attribute","Name","FloorDiv","Mod","RShift","LShift","BitAnd","BitXor","BitOr","Div","Mult","Sub","Add","DEF_LOCAL","Call","CodeWriter","RangeAnnotated"],"mappings":"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"}